<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Resource Loading Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            line-height: 1.6;
            color: #333;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
        }
        h1 {
            color: #2c3e50;
        }
        .test-group {
            border: 1px solid #ddd;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 5px;
        }
        .test-item {
            margin-bottom: 10px;
            padding: 10px;
            background-color: #f9f9f9;
        }
        .success {
            color: green;
            font-weight: bold;
        }
        .fail {
            color: red;
            font-weight: bold;
        }
        .pending {
            color: orange;
            font-weight: bold;
        }
        #log {
            height: 200px;
            overflow-y: auto;
            border: 1px solid #ccc;
            padding: 10px;
            background-color: #f5f5f5;
            font-family: monospace;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Resource Loading Test</h1>
        <p>This page tests whether all required resources for the experiment load correctly.</p>
        
        <div class="test-group">
            <h2>External Libraries</h2>
            <div id="jquery-test" class="test-item">jQuery: <span class="pending">Checking...</span></div>
            <div id="jqueryui-test" class="test-item">jQuery UI: <span class="pending">Checking...</span></div>
            <div id="preloadjs-test" class="test-item">PreloadJS: <span class="pending">Checking...</span></div>
        </div>
        
        <div class="test-group">
            <h2>PsychoJS</h2>
            <div id="psychojs-test" class="test-item">PsychoJS Library: <span class="pending">Checking...</span></div>
            <div id="psychojs-core-test" class="test-item">PsychoJS Core: <span class="pending">Checking...</span></div>
            <div id="psychojs-visual-test" class="test-item">PsychoJS Visual: <span class="pending">Checking...</span></div>
        </div>
        
        <div class="test-group">
            <h2>WebGazer</h2>
            <div id="webgazer-test" class="test-item">WebGazer Library: <span class="pending">Checking...</span></div>
            <div id="webgazer-methods-test" class="test-item">WebGazer Methods: <span class="pending">Checking...</span></div>
        </div>
        
        <div class="test-group">
            <h2>ES Modules Support</h2>
            <div id="es-modules-test" class="test-item">ES Modules: <span class="pending">Checking...</span></div>
        </div>
        
        <button id="run-tests">Run Tests Again</button>
        
        <div id="log"></div>
    </div>
    
    <!-- External libraries -->
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jquery-ui-dist@1.12.1/jquery-ui.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/preloadjs@1.0.1/lib/preloadjs.min.js"></script>
    
    <!-- PsychoJS configuration -->
    <script type="text/javascript">
        window.psychoJS = {
            debug: true,
            collectIP: false,
            hosts: {
                local: '',
                pavlovia: 'https://pavlovia.org'
            },
            log: function() {
                if (window.psychoJS.debug) {
                    console.log.apply(console, arguments);
                }
            },
        };
    </script>
    
    <!-- Testing script -->
    <script>
        function logMessage(message) {
            const logElement = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            logElement.innerHTML += `[${timestamp}] ${message}<br>`;
            logElement.scrollTop = logElement.scrollHeight;
        }
        
        function updateTestResult(id, success, message) {
            const element = document.getElementById(id).querySelector('span');
            element.className = success ? 'success' : 'fail';
            element.textContent = message || (success ? 'Success' : 'Failed');
            logMessage(`${id}: ${message || (success ? 'Success' : 'Failed')}`);
        }
        
        function runTests() {
            // Reset results
            document.querySelectorAll('.test-item span').forEach(el => {
                el.className = 'pending';
                el.textContent = 'Checking...';
            });
            
            // Clear log
            document.getElementById('log').innerHTML = '';
            logMessage('Starting tests...');
            
            // Test jQuery
            setTimeout(() => {
                try {
                    if (typeof jQuery !== 'undefined') {
                        updateTestResult('jquery-test', true, `Success (v${jQuery.fn.jquery})`);
                    } else {
                        updateTestResult('jquery-test', false);
                    }
                } catch (e) {
                    updateTestResult('jquery-test', false, `Error: ${e.message}`);
                }
            }, 100);
            
            // Test jQuery UI
            setTimeout(() => {
                try {
                    if (typeof jQuery !== 'undefined' && typeof jQuery.ui !== 'undefined') {
                        updateTestResult('jqueryui-test', true, `Success (v${jQuery.ui.version})`);
                    } else {
                        updateTestResult('jqueryui-test', false);
                    }
                } catch (e) {
                    updateTestResult('jqueryui-test', false, `Error: ${e.message}`);
                }
            }, 200);
            
            // Test PreloadJS
            setTimeout(() => {
                try {
                    if (typeof createjs !== 'undefined' && typeof createjs.LoadQueue !== 'undefined') {
                        updateTestResult('preloadjs-test', true);
                    } else {
                        updateTestResult('preloadjs-test', false);
                    }
                } catch (e) {
                    updateTestResult('preloadjs-test', false, `Error: ${e.message}`);
                }
            }, 300);
            
            // Load PsychoJS
            const psychojsScript = document.createElement('script');
            psychojsScript.src = './lib/psychojs-2021.2.3.js';
            psychojsScript.onload = function() {
                updateTestResult('psychojs-test', true);
                
                // Test PsychoJS Core
                try {
                    if (typeof psychoJS !== 'undefined') {
                        updateTestResult('psychojs-core-test', true);
                    } else {
                        updateTestResult('psychojs-core-test', false);
                    }
                } catch (e) {
                    updateTestResult('psychojs-core-test', false, `Error: ${e.message}`);
                }
                
                // Test PsychoJS Visual
                try {
                    // This will test via dynamic import
                    import('./lib/psychojs-2021.2.3.js')
                        .then(module => {
                            if (module && module.visual) {
                                updateTestResult('psychojs-visual-test', true);
                                updateTestResult('es-modules-test', true);
                            } else {
                                updateTestResult('psychojs-visual-test', false, 'Module loaded but visual not found');
                            }
                        })
                        .catch(err => {
                            updateTestResult('psychojs-visual-test', false, `Import error: ${err.message}`);
                            updateTestResult('es-modules-test', false, `Failed: ${err.message}`);
                        });
                } catch (e) {
                    updateTestResult('psychojs-visual-test', false, `Error: ${e.message}`);
                }
            };
            psychojsScript.onerror = function() {
                updateTestResult('psychojs-test', false);
                updateTestResult('psychojs-core-test', false, 'PsychoJS not loaded');
                updateTestResult('psychojs-visual-test', false, 'PsychoJS not loaded');
            };
            document.head.appendChild(psychojsScript);
            
            // Load WebGazer
            const webgazerScript = document.createElement('script');
            webgazerScript.src = './webgazer-2.0.1.js';
            webgazerScript.onload = function() {
                updateTestResult('webgazer-test', true);
                
                // Test WebGazer methods
                try {
                    if (typeof webgazer !== 'undefined' && typeof webgazer.setGazeListener === 'function') {
                        updateTestResult('webgazer-methods-test', true);
                    } else {
                        updateTestResult('webgazer-methods-test', false, 'WebGazer loaded but methods missing');
                    }
                } catch (e) {
                    updateTestResult('webgazer-methods-test', false, `Error: ${e.message}`);
                }
            };
            webgazerScript.onerror = function() {
                // Try alternative WebGazer file
                const altWebgazerScript = document.createElement('script');
                altWebgazerScript.src = './webgazer-2.0.1.tp.js';
                altWebgazerScript.onload = function() {
                    updateTestResult('webgazer-test', true, 'Success (alternate file)');
                    
                    // Test WebGazer methods
                    try {
                        if (typeof webgazer !== 'undefined' && typeof webgazer.setGazeListener === 'function') {
                            updateTestResult('webgazer-methods-test', true);
                        } else {
                            updateTestResult('webgazer-methods-test', false, 'WebGazer loaded but methods missing');
                        }
                    } catch (e) {
                        updateTestResult('webgazer-methods-test', false, `Error: ${e.message}`);
                    }
                };
                altWebgazerScript.onerror = function() {
                    updateTestResult('webgazer-test', false, 'Failed to load from both sources');
                    updateTestResult('webgazer-methods-test', false, 'WebGazer not loaded');
                };
                document.head.appendChild(altWebgazerScript);
            };
            document.head.appendChild(webgazerScript);
        }
        
        // Run tests when page loads
        document.addEventListener('DOMContentLoaded', runTests);
        
        // Run tests again when button is clicked
        document.getElementById('run-tests').addEventListener('click', runTests);
    </script>
</body>
</html> 